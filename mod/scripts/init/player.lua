---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by darionco.
--- DateTime: 2021-01-17 2:10 p.m.
---

modimport('scripts/teams/CTFTeamManager');

local require = GLOBAL.require;
local inventory = require('init/player_inventory');

local function OnPlayerSpawned(player)
    CTFTeamManager:registerPlayer(player);

    if TheWorld.ismastersim then
        player:RemoveEventCallback('colourtweener_end', OnPlayerSpawned);
        player.player_classified.ctf_net_on_player_spawned:push();
    else
        player:RemoveEventCallback('ctf_net_on_player_spawned', OnPlayerSpawned, player);
    end
end

AddPrefabPostInit('player_classified', function(inst)
    inst.ctf_net_on_player_spawned = GLOBAL.net_event(inst.GUID, 'ctf_net_on_player_spawned');
    if not TheWorld.ismastersim then
        inst:ListenForEvent('ctf_net_on_player_spawned', OnPlayerSpawned, inst.entity:GetParent());
    end
end);

AddComponentPostInit('playervision', function(component)
    component.inst:DoTaskInTime(0, function(player)
        if TheWorld.ismastersim then
            inventory.removeAllItems(player);
            inventory.initializeInventory(player);
            player:ListenForEvent('colourtweener_end', OnPlayerSpawned);
        end
    end)
end);
